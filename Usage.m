clear;

%Transformation Matrix. For calibration purpose.
%Config.T=[ 1.029624, -0.0138,   -0.152812;
%           0.006218,  1.018914, -0.013183;
%          -0.00025,  -0.00167,  -1.021651];
Config.T = eye(3);

%Sensitivity of string pot reading(sort of calibration factor)
Config.sensitivity = [1 1 1]';
	
	
%Pin locations: Model coordinate system, inches. Origin of coordinate system should be platform center
Config.S1b = [-496.085,  3.349,  -6.998]'/25.4;		% base coordinate
Config.S1p = [-228.064, -2.602,   0.674]'/25.4;		% platform coordinate

%Config.S1b = [496.085,  3.349,  -6.998]'/25.4;		% base coordinate    
%Config.S1p = [228.064, -2.602,   0.674]'/25.4;		% platform coordinate                         

Config.S2b = [-193.208, -423.583,-4.428]'/25.4;		% base coordinate    
Config.S2p = [-191.633, -0.103,  -6.959]'/25.4;            	% platform coordinate
                 
Config.S3b = [ 187.711, -449.115,-5.257]'/25.4;		% base coordinate    
Config.S3p = [ 189.679, -6.127,  -0.217]'/25.4;             	% platform coordinate


%Offset for specimen: LBCB coordinate system, inches. Offset from motion center. X, Z, RY
%Config.Off_SPCM = [-0.26602 0 -0.4 0 -0.01 0]';
Config.Off_SPCM = [0 0 0 0 0 0]';

%Offset for motion center: LBCB coordinate system
%Config.Off_MCTR = [-1.5 0 1]';
Config.Off_MCTR = [0 0 0]';

% Allowable tolerance
Config.TOL = [0.0001 0.0001 0.00005]';

% Perturbation for jacobian estimation 
Config.dx  = 0.001;
Config.dy  = 0.001;
Config.drz = 0.001;

% ===================================================================================
State.StepNo       = 1;
State.S1b_off      = zeros(3,1);
State.S2b_off      = zeros(3,1);
State.S3b_off      = zeros(3,1);
State.S1p_off      = zeros(3,1);
State.S2p_off      = zeros(3,1);
State.S3p_off      = zeros(3,1);
State.S            = zeros(3,1);
State.So           = zeros(3,1);
State.Platform_Ctr = zeros(3,1);
State.Strn_Inc     = zeros(3,1);
State.J            = zeros(3,3);
State.Strn_Inc     = zeros(3,1);

%ExtMesur = [10.1095-10.5589  
%	    16.2259-16.6729  
%	    18.3022-17.4418];

%ExtMesur = [11.1292-10.5589
%	    16.2259-16.6729
%	    18.3022-17.4418];

ExtMesur = [	0.000000000e+000	0.000000000e+000	0.000000000e+000
0.000000000e+000	0.000000000e+000	0.000000000e+000
0.000000000e+000	0.000000000e+000	0.000000000e+000
0.000000000e+000	0.000000000e+000	0.000000000e+000
0.000000000e+000	0.000000000e+000	0.000000000e+000
0.000000000e+000	0.000000000e+000	0.000000000e+000
0.000000000e+000	0.000000000e+000	0.000000000e+000
0.000000000e+000	0.000000000e+000	0.000000000e+000
0.000000000e+000	0.000000000e+000	0.000000000e+000
0.000000000e+000	0.000000000e+000	0.000000000e+000
0.000000000e+000	0.000000000e+000	0.000000000e+000
0.000000000e+000	0.000000000e+000	0.000000000e+000
0.000000000e+000	0.000000000e+000	0.000000000e+000
0.000000000e+000	0.000000000e+000	0.000000000e+000
0.000000000e+000	0.000000000e+000	0.000000000e+000
0.000000000e+000	0.000000000e+000	0.000000000e+000
0.000000000e+000	0.000000000e+000	0.000000000e+000
0.000000000e+000	0.000000000e+000	0.000000000e+000
0.000000000e+000	0.000000000e+000	0.000000000e+000
0.000000000e+000	0.000000000e+000	0.000000000e+000
1.842150163e-003	6.667315355e-003	6.668419437e-003
3.688553229e-003	1.333484596e-002	1.333704309e-002
5.539215135e-003	2.000265557e-002	2.000593475e-002
7.394117266e-003	2.667061584e-002	2.667496609e-002
9.253254189e-003	3.333888648e-002	3.334429683e-002
9.253254189e-003	3.333888648e-002	3.334429683e-002
9.253254189e-003	3.333888648e-002	3.334429683e-002
9.253254189e-003	3.333888648e-002	3.334429683e-002
9.253254189e-003	3.333888648e-002	3.334429683e-002
9.253254189e-003	3.333888648e-002	3.334429683e-002
9.253254189e-003	3.333888648e-002	3.334429683e-002
9.253254189e-003	3.333888648e-002	3.334429683e-002
9.253254189e-003	3.333888648e-002	3.334429683e-002
9.253254189e-003	3.333888648e-002	3.334429683e-002
9.253254189e-003	3.333888648e-002	3.334429683e-002
9.253254189e-003	3.333888648e-002	3.334429683e-002
9.253254189e-003	3.333888648e-002	3.334429683e-002
9.253254189e-003	3.333888648e-002	3.334429683e-002
9.253254189e-003	3.333888648e-002	3.334429683e-002
9.253254189e-003	3.333888648e-002	3.334429683e-002
9.253254189e-003	3.333888648e-002	3.334429683e-002
9.253254189e-003	3.333888648e-002	3.334429683e-002
9.253254189e-003	3.333888648e-002	3.334429683e-002
9.253254189e-003	3.333888648e-002	3.334429683e-002
9.253254189e-003	3.333888648e-002	3.334429683e-002
1.040962186e-002	3.902374236e-002	3.902974409e-002
1.156906713e-002	4.470861013e-002	4.471519882e-002
1.273149111e-002	5.039364925e-002	5.040082042e-002
1.273149111e-002	5.039364925e-002	5.040082042e-002
1.273149111e-002	5.039364925e-002	5.040082042e-002
1.273149111e-002	5.039364925e-002	5.040082042e-002]';
		
for i=1:length(ExtMesur)
	[tmp State] = Extmesu2Cartesian(ExtMesur(:,i),State,Config);
	Cartesian(i,:) = tmp';
end


Cartesian   

%State.StepNo = 2;
%ExtMesur = [11.3299-10.5589  
%            17.8478-16.6729  
%            17.3070-17.4418];
%ExtMesur(1) = ExtMesur(1)*(-1);
%[Cartesian State] = Extmesu2Cartesian(ExtMesur,State,Config);
%Cartesian